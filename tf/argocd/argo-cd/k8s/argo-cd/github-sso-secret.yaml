%{ if external_secret_type == "kes" ~}
apiVersion: kubernetes-client.io/v1
%{ endif ~}
%{ if external_secret_type == "eso" ~}
apiVersion: external-secrets.io/v1beta1
%{ endif ~}
kind: ExternalSecret
metadata:
  name: github-sso-secret
spec:
%{ if external_secret_type == "kes" ~}
  backendType: secretsManager
%{ endif ~}
%{ if external_secret_type == "eso" ~}
  refreshInterval: 1m
  secretStoreRef:
    name: ${external_secret_eso_kind_name}
    kind: ${external_secret_eso_kind}
  target:
    creationPolicy: Owner
%{ endif ~}
%{ if external_secret_type == "kes" ~}
  data:
    - key: ${github_sso_secret_name}
      name: dex.github.clientSecret
      property: clientSecret
    - key: ${github_sso_secret_name}
      name: dex.github.clientID
      property: clientID
%{ endif ~}
%{ if external_secret_type == "eso" ~}
  data:
    - secretKey: dex.github.clientSecret
      remoteRef:
        key: ${github_sso_secret_name}
        property: clientSecret
    - secretKey: dex.github.clientID
      remoteRef:
        key: ${github_sso_secret_name}
        property: clientID
%{ endif ~}
